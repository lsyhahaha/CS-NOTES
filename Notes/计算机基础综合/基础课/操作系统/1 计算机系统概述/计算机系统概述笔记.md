# 1.1操作系统的基本概念

### 1.1.1操作系统的基本概念

操作系统：

①是控制和管理整个计算机系统的硬件与软件资源；

②合理地组织、调度计算机的工作与资源的分配，进而为用户和其他软件提供方便接口与环境的程序集合。

③操作系统是计算机系统重最基本的系统软件。



### 1.1.2操作系统的特征

1.并发：是指两个或者多个事件在同一时间间隔内发生。

2.共享：

​	（1）互斥共享方式：

​	（2）同时访问方式：

3.虚拟：指一个物理上的实体变为若干逻辑上的对应物。

4.异步:躲到程序环境允许多个程序并发执行，但由于资源有限，进程的执行并不是一贯到底的，而是走走停停的，它以不可预知的速度向前推进，这就是进程异步性。

$\textcolor{red}{并发和共享是操作系统两个最基本的特征。}$



### 1.1.3操作系统的目标和功能

$\textcolor{red}{1.操作系统作为计算机系统资源的管理者}$

操作系统应该具有以下几方面的功能：处理机管理、存储器管理、设备管理和文件管理。

（1）处理机管理

（2）存储器管理

（3）设备管理

（4）文件管理



$\textcolor{red}{2.操作系统作为用户与计算机硬件系统之间的接口}$

（1）命令接口

（2）程序接口

程序接口由一组系统调用组成。

系统调用也称为广义指令。



$\textcolor{red}{3.操作系统实现了对计算机资源的扩充}$

没有任何软件支持的计算机称为裸机；

通常吧覆盖了软件的机器称为扩充机器和虚拟机；



### 1.1.4课后习题（p5-p6）

### 1.1.5答案







# 1.2操作系统发展历程

### 1.2.1手工操作系统（此阶段无操作系统）

### 1.2.2批处理操作系统

### 1.2.3分时操作系统

### 1.2.4实时操作系统

### 1.2.5网络操作系统和分布式计算机系统

### 1.2.6个人计算机操作系统

### 1.2.7课后习题

### 1.2.8答案





# 1.3操作系统运行环境

### 1.3.1处理器运行模式

在操作系统中，处理器（CPU）可以运行在不同的运行模式，也称为特权级或特权模式。这些运行模式决定了处理器能够访问和执行的指令集、硬件资源以及系统级的操作。一般来说，操作系统会根据不同的任务和需求，将处理器切换到不同的运行模式。在现代计算机系统中，常见的处理器运行模式有以下几种：

1. 用户态（User Mode）：在用户态下，处理器受限制，只能执行受限的指令集，无法直接访问系统资源和硬件设备。用户程序运行在用户态下，其对操作系统资源的访问需要通过系统调用（syscall）来进行，由操作系统来处理用户程序的请求。用户态是为了保护操作系统的稳定性和安全性，防止用户程序对系统资源的滥用。
2. 内核态（Kernel Mode）：在内核态下，处理器拥有最高的特权，可以执行全部指令集，直接访问系统资源和硬件设备。操作系统内核运行在内核态下，它可以执行关键的系统操作，如处理中断、管理进程、内存、设备等。只有处于内核态的操作系统内核才能对硬件进行直接控制和管理。

当一个程序执行时，它在初始状态下运行在用户态，只有在需要访问受限资源或执行特权指令时，才会通过系统调用进入内核态，然后操作系统会处理请求并返回结果给用户程序，并将处理器切换回用户态。

通过特权级的切换，操作系统可以保护系统的稳定性和安全性，防止用户程序的错误或恶意行为对整个系统造成影响。同时，这种特权级切换也使得操作系统能够有效地管理系统资源，并提供各种系统功能和服务。

### 1.3.2中断和异常的概念

在操作系统中，中断（Interrupt）和异常（Exception）是两种不同的事件，它们用于处理计算机系统中的异步事件或异常情况。这些事件可以打破程序的正常执行流程，需要操作系统介入并进行相应的处理。

1. 中断（Interrupt）： 中断是指计算机系统中发生的外部事件或硬件事件，它可以打断当前正在执行的程序，让处理器转而执行中断处理程序。中断可以来自硬件设备（如定时器中断、键盘输入中断、磁盘I/O中断等）或其他外部信号（如电源故障中断）。

当中断事件发生时，处理器会立即中止当前任务的执行，保存当前的上下文（即程序计数器、寄存器等状态），然后跳转到预先定义好的中断处理程序。中断处理程序负责处理相应的中断事件，可能包括保存中断相关信息、处理硬件设备或处理特定事件。

1. 异常（Exception）： 异常是指在程序执行过程中出现的非正常情况或错误情况，例如除零错误、访问无效内存、非法指令等。异常通常是由程序错误或意外情况引起的，并且它们需要操作系统来处理和纠正。

当异常事件发生时，处理器会立即暂停当前任务的执行，保存当前的上下文，并跳转到相应的异常处理程序。异常处理程序负责分析和处理异常情况，可能包括修复错误、终止出错的程序、向用户报告异常等。

区别：

- 中断是外部事件或硬件事件触发的，而异常是由程序执行过程中的错误或非正常情况触发的。
- 中断通常来自外部设备或其他外部信号，而异常是由处理器或程序执行过程中的错误引起的。
- 中断的处理程序用于处理外部事件，而异常的处理程序用于处理程序执行中的异常情况。

无论是中断还是异常，它们都是操作系统处理异步事件和异常情况的重要机制，确保计算机系统的正常运行和稳定性。

### 1.3.3系统调用

在操作系统中，系统调用（System Call）是用户程序与操作系统之间进行交互的接口。它允许用户程序请求操作系统提供特权操作和系统服务，以执行那些需要特殊权限或硬件控制的任务。系统调用允许用户程序访问操作系统的功能，如文件操作、网络通信、进程管理等，而不需要了解底层的实现细节或直接操作硬件。

用户程序通常运行在用户态，处于受限的执行环境，无法直接访问系统资源和硬件设备。为了使用操作系统的功能，用户程序需要通过系统调用来向操作系统发起请求。当用户程序需要执行特权操作或访问系统资源时，它会使用特定的系统调用指令（如x86架构的int 0x80，x86-64架构的syscall等）触发中断或异常，将控制权交给操作系统内核。

操作系统内核会识别并处理这些中断或异常，根据用户程序请求的类型来执行相应的系统调用处理程序。系统调用处理程序负责验证用户程序的请求，检查参数的合法性，执行相应的操作，并返回结果给用户程序。

常见的系统调用包括：

- 文件操作：打开、读取、写入、关闭文件等。
- 进程管理：创建进程、结束进程、等待进程状态等。
- 内存管理：分配和释放内存、修改内存权限等。
- 网络通信：建立网络连接、发送和接收数据等。
- 设备控制：打开、关闭设备、控制设备状态等。

通过系统调用，用户程序能够利用操作系统的功能和资源，实现更复杂和全面的任务。系统调用提供了安全的方式让用户程序访问操作系统，同时也允许操作系统对用户程序的请求进行控制和验证，确保系统的稳定性和安全性。

### 1.3.4课后习题

### 1.3.5答案





# 1.4操作系统结构

操作系统结构是指操作系统在组织和管理计算机资源时的总体布局和组织方式。不同的操作系统可能采用不同的结构，但大多数操作系统都可以划分为以下常见的几种结构：

1. 单体结构（Monolithic Architecture）： 单体结构是最早的操作系统结构，它将操作系统的所有功能模块都集成在一个单独的大内核中。在这种结构下，操作系统内核包含了处理器管理、内存管理、文件系统、设备驱动程序等所有功能。这些功能模块彼此紧密耦合，共享相同的地址空间。单体结构简单直接，但随着操作系统的功能增加，内核变得庞大复杂，不易维护和扩展。
2. 分层结构（Layered Architecture）： 分层结构将操作系统划分为多个层次，每个层次提供特定的功能，并建立层与层之间的接口。通常，较高层次的功能依赖于较低层次的功能。这样的结构使得操作系统更加模块化，便于维护和调试。但是，分层结构可能导致层与层之间的性能开销，因为每次操作都需要通过多个层次。
3. 微内核结构（Microkernel Architecture）： 微内核结构将操作系统内核分为两部分：一个小而精简的微内核和多个运行在用户态的服务。微内核负责提供最基本的操作系统功能，如进程管理、内存管理和进程间通信。其他功能则通过用户态的服务来实现，这些服务可以动态加载和替换，从而增加了系统的灵活性和可扩展性。
4. 客户端-服务器结构（Client-Server Architecture）： 客户端-服务器结构是一种特殊的微内核结构，它将操作系统划分为多个独立的服务，每个服务都作为一个服务器，提供特定的功能。用户程序通过客户端接口来访问这些服务。这种结构允许操作系统的服务在不同的地址空间中运行，提高了系统的稳定性和安全性。
5. 虚拟机结构（Virtual Machine Architecture）： 虚拟机结构将操作系统划分为多个虚拟机，每个虚拟机都运行一个完整的操作系统实例。这些虚拟机可以是完全隔离的，每个虚拟机有自己的地址空间、文件系统和进程管理。虚拟机结构可以在一台物理计算机上同时运行多个操作系统，提高了资源利用率和系统灵活性。

以上是常见的操作系统结构，每种结构都有其优缺点，选择适合的结构取决于具体的应用和需求。现代操作系统通常采用多种结构的组合，以实现更高效、稳定和安全的计算机系统。





# 1.5操作系统引导

操作系统引导（Bootstrapping）是指计算机系统在加电或重启时，如何启动并加载操作系统的过程。在这个过程中，计算机需要找到并加载操作系统的引导程序（Bootloader），并将控制权转交给操作系统的内核，从而使得操作系统能够开始运行。

以下是操作系统引导的基本步骤：

1. 加电和自检（Power-On Self-Test, POST）：当计算机加电时，首先会进行自检过程，检测硬件设备和组件是否正常工作。这包括检查内存、显卡、硬盘、键盘等，以确保计算机硬件处于正常工作状态。
2. BIOS/UEFI初始化：自检完成后，计算机会加载并运行基本输入输出系统（Basic Input Output System, BIOS）或统一的可扩展固件接口（Unified Extensible Firmware Interface, UEFI）。BIOS/UEFI是固化在主板上的程序，它提供了一些基本的硬件初始化和引导功能。
3. 引导设备选择：BIOS/UEFI将根据预定义的引导顺序（通常是从硬盘、光盘、USB等设备）来选择一个合适的引导设备。它会依次检查这些设备是否存在引导记录。
4. 引导记录加载：一旦找到合适的引导设备，BIOS/UEFI会加载该设备的引导记录（Boot Record），它通常位于设备的引导扇区（通常是硬盘的第一个扇区）。
5. 引导程序执行：引导记录中包含引导程序（Bootloader），这是一个小型的程序，负责进一步加载操作系统的内核。引导程序将控制权转交给操作系统的内核，并将内核加载到内存中。
6. 操作系统内核加载：操作系统的内核被加载到内存后，它会初始化系统的各个部分，如内存管理、进程管理、设备管理等。一旦初始化完成，操作系统就准备好了开始运行用户程序。
7. 用户程序加载：操作系统内核会从合适的存储介质（硬盘、网络等）加载用户程序到内存中，并开始执行用户程序。

总的来说，操作系统引导是计算机系统启动过程中的关键步骤，它负责加载并运行操作系统，使计算机能够正常工作并为用户程序提供运行环境。







# 1.6虚拟机

### 1.6.1虚拟机的基本概念

虚拟机是一种计算机技术，它允许在一台物理计算机上创建多个虚拟计算机环境。每个虚拟机都是一个独立的、隔离的操作系统实例，它可以运行自己的应用程序和服务，就像是一台独立的计算机一样。虚拟机的基本概念包括以下几个方面：

1. 虚拟化层：虚拟机技术是通过虚拟化层来实现的。虚拟化层是一个软件或硬件的抽象层，它允许多个虚拟机共享物理计算机的硬件资源，如处理器、内存、存储和网络等。
2. 宿主机和客户机：在虚拟机环境中，物理计算机被称为宿主机（Host Machine），它是运行虚拟化软件的主机系统。而每个虚拟化出来的独立计算机环境被称为客户机（Guest Machine），它们运行在宿主机上的虚拟机中。
3. 虚拟机监视器（Hypervisor）：虚拟机监视器是虚拟化层的核心组件，它负责管理和分配宿主机的硬件资源给各个虚拟机，并确保虚拟机之间的隔离性。虚拟机监视器有两种类型：类型1和类型2。类型1是直接运行在宿主机硬件上的，称为裸机虚拟化，如VMware ESXi、Microsoft Hyper-V。类型2运行在宿主机的操作系统之上，需要通过操作系统来访问硬件资源，如VMware Workstation、VirtualBox。
4. 虚拟硬件：在虚拟机中，每个虚拟机都被赋予了虚拟硬件，包括虚拟的处理器、内存、硬盘、网卡等。这些虚拟硬件是虚拟化层提供给虚拟机的抽象，虚拟机并不直接访问宿主机的物理硬件，而是通过虚拟硬件来模拟访问。
5. 虚拟机镜像：虚拟机镜像是一个包含操作系统和应用程序的软件包，它被用来创建虚拟机实例。虚拟机镜像可以被复制、保存、备份，并且可以在不同的虚拟机之间迁移和部署。

虚拟机技术提供了一种有效的方式来提高计算机资源的利用率，节省硬件成本，并且提供了更好的系统管理和隔离性。它被广泛应用于服务器虚拟化、云计算、开发和测试环境等领域。







### 1.6.2课后习题

### 1.6.3答案







# 1.7本章疑难点

###### $\textcolor{Red}{1.并行性和并发性的区别与联系} $

###### $\textcolor{red}{2.特权指令和非特权指令}$

###### $\textcolor{red}{3.访管指令与访管中断}$
$\textcolor{red}{ 4.定义微内核结构OS的四个方面}$